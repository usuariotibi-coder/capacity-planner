# Team Capacity Planner - Deployment Guide

Complete guide for deploying the Team Capacity Planner backend to Railway.

## ðŸ“‹ Prerequisites

- GitHub account with the code repository pushed
- Railway account (free at [railway.app](https://railway.app))
- Basic knowledge of environment variables and PostgreSQL

## ðŸš€ Step-by-Step Railway Deployment

### Step 1: Create Railway Project

1. Go to [Railway.app](https://railway.app)
2. Click "Start a New Project"
3. Select "Deploy from GitHub"
4. Connect your GitHub account
5. Select the repository containing the code

### Step 2: Add PostgreSQL Database

1. In your Railway project, click "Add Service"
2. Select "PostgreSQL"
3. Railway will provision a PostgreSQL database automatically

### Step 3: Configure Environment Variables

In Railway dashboard, go to **Variables** and set:

```
# Django Configuration
DEBUG=False
SECRET_KEY=generate-a-secure-key-use-django-secret-key-generator
ALLOWED_HOSTS=your-app.railway.app,localhost
ENVIRONMENT=production

# Database (Railway provides this automatically)
DATABASE_URL=postgresql://[automatically generated]

# If using explicit DB vars instead of DATABASE_URL:
DB_ENGINE=django.db.backends.postgresql
DB_NAME=capacity_planner
DB_USER=postgres
DB_PASSWORD=[auto-generated by Railway]
DB_HOST=[Railway-provided host]
DB_PORT=5432

# CORS Configuration (Update with your frontend URL)
CORS_ALLOWED_ORIGINS=https://your-frontend.railway.app,https://yourdomain.com

# JWT Configuration (optional, defaults are good)
JWT_ACCESS_TOKEN_LIFETIME=86400
JWT_REFRESH_TOKEN_LIFETIME=604800
```

### Step 4: Generate Secret Key

Generate a secure Django secret key:

**Option 1: Using Python**
```bash
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
```

**Option 2: Using OpenSSL**
```bash
openssl rand -base64 32
```

Copy the generated key and paste it in Railway's `SECRET_KEY` variable.

### Step 5: Configure Build & Deploy Settings

1. In Railway, go to **Settings**
2. Set these values:
   - **Build Command**: Leave empty (uses Dockerfile)
   - **Start Command**: Leave empty (uses Procfile)
   - **Port**: 8000
   - **Python Version**: 3.11

### Step 6: Deploy

1. Push your code to GitHub:
```bash
git add .
git commit -m "Ready for deployment"
git push origin main
```

2. Railway will automatically detect changes and redeploy

### Step 7: Run Initial Migrations

After first deployment:

1. Go to Railway dashboard
2. Open the web service
3. Click on "Logs" tab
4. Look for deployment logs - migrations should run automatically via Procfile

If migrations didn't run:
1. Click "Settings" on the web service
2. Find "Execute Command" section
3. Run: `python manage.py migrate`

### Step 8: Create Superuser

Access your deployed app terminal:

```bash
# Via Railway CLI
railway run python manage.py createsuperuser

# Or via Railway dashboard:
# 1. Select your web service
# 2. Go to "Deployment" tab
# 3. Click the running deployment
# 4. Open shell/terminal
# 5. Run: python manage.py createsuperuser
```

## ðŸ”’ Environment Variables Checklist

- [ ] `DEBUG=False` (never True in production)
- [ ] `SECRET_KEY` set to a secure random string
- [ ] `ALLOWED_HOSTS` includes your Railway domain
- [ ] `DATABASE_URL` configured for PostgreSQL
- [ ] `CORS_ALLOWED_ORIGINS` includes your frontend URL
- [ ] All database variables set (if not using DATABASE_URL)

## ðŸ§ª Testing Deployment

After deployment is complete:

```bash
# Test API availability
curl https://your-app.railway.app/api/

# Test authentication endpoint
curl -X POST https://your-app.railway.app/api/token/ \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "password"}'

# Test with token
curl -H "Authorization: Bearer <your-token>" \
  https://your-app.railway.app/api/employees/
```

## ðŸ“Š Monitoring & Logs

### View Logs
1. Go to your Railway project
2. Select the web service
3. Click "Logs" tab
4. See real-time application logs

### Common Issues

#### Error: "relation does not exist"
- Migrations didn't run
- Solution: Manually run `python manage.py migrate` in Railway shell

#### Error: "CORS policy: blocked"
- Frontend URL not in CORS_ALLOWED_ORIGINS
- Solution: Update CORS_ALLOWED_ORIGINS in Railway variables

#### Error: "SECRET_KEY not set"
- SECRET_KEY environment variable missing
- Solution: Add to Railway variables

#### Error: "could not connect to database"
- Database credentials wrong or database not running
- Solution: Check DB variables match Railway-provided values

## ðŸ”„ Continuous Deployment

Railway automatically redeploys when you push to your main branch:

1. Make changes locally
2. Commit and push:
   ```bash
   git add .
   git commit -m "Your message"
   git push origin main
   ```
3. Railway detects the push and redeploys automatically
4. Watch logs to confirm successful deployment

## ðŸ“ˆ Scaling for 50+ Users

Railway automatically handles scaling. Configuration:

1. **Memory**: Default 256MB is sufficient for 50 users
   - For 100+ users, increase to 512MB

2. **CPU**: Shared CPU sufficient for 50 users
   - For 100+ users, upgrade to dedicated

3. **Database**: Default PostgreSQL sufficient
   - For high volume, consider upgrading plan

### Monitor Performance

1. Go to Railway dashboard
2. View "Metrics" tab
3. Monitor CPU, Memory, and Network usage

## ðŸ” Security Best Practices

- [ ] Use strong SECRET_KEY (minimum 32 characters)
- [ ] Set DEBUG=False in production
- [ ] Use HTTPS only (Railway provides SSL automatically)
- [ ] Regularly rotate secrets and tokens
- [ ] Enable Railway's security features
- [ ] Set up monitoring and alerts
- [ ] Regularly update dependencies

## ðŸš¨ Backup & Recovery

### Database Backups

Railway automatically backs up PostgreSQL databases.

To download a backup:
1. Go to PostgreSQL service in Railway
2. Click "Data" tab
3. Download backup file

### Manual Backup

```bash
# Via Railway CLI
railway run pg_dump $DATABASE_URL > backup.sql
```

## ðŸŽ¯ Production Checklist

Before going live:

- [ ] SECRET_KEY is secure and set
- [ ] DEBUG is False
- [ ] ALLOWED_HOSTS includes your domain
- [ ] Database is PostgreSQL
- [ ] CORS_ALLOWED_ORIGINS configured for frontend
- [ ] All migrations applied
- [ ] Superuser created
- [ ] Static files configured
- [ ] Email configuration (if needed)
- [ ] SSL certificate (automatic on Railway)
- [ ] Monitoring enabled
- [ ] Backups configured
- [ ] Team has access to Railway dashboard

## ðŸ“ž Support & Troubleshooting

### Railway Support
- [Railway Documentation](https://docs.railway.app)
- [Railway Community Discord](https://discord.gg/railway)

### Django Support
- [Django Documentation](https://docs.djangoproject.com)
- [Django REST Framework](https://www.django-rest-framework.org)

### Common Commands

```bash
# Connect to Railway CLI
railway login
railway link  # Link local project to Railway project

# Run commands remotely
railway run python manage.py shell
railway run python manage.py migrate
railway run python manage.py createsuperuser

# View logs
railway logs

# Redeploy
railway deploy
```

## ðŸŽ“ Additional Resources

- [Railway Django Tutorial](https://docs.railway.app/guides/django)
- [Django Deployment Checklist](https://docs.djangoproject.com/en/4.2/howto/deployment/checklist/)
- [PostgreSQL Best Practices](https://www.postgresql.org/docs/current/sql-syntax.html)

---

**Last Updated**: January 6, 2026
**Version**: 1.0.0

For additional help, refer to API_DOCUMENTATION.md or README.md
