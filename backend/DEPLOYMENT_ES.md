# Planificador de Capacidad del Equipo - Gu칤a de Despliegue

Gu칤a completa para desplegar el backend de Team Capacity Planner en Railway.

## 游늶 Requisitos Previos

- Cuenta de GitHub con el repositorio de c칩digo enviado
- Cuenta de Railway (gratis en [railway.app](https://railway.app))
- Conocimiento b치sico de variables de entorno y PostgreSQL

## 游 Despliegue Paso a Paso en Railway

### Paso 1: Crear Proyecto en Railway

1. Ve a [Railway.app](https://railway.app)
2. Haz clic en "Start a New Project"
3. Selecciona "Deploy from GitHub"
4. Conecta tu cuenta de GitHub
5. Selecciona el repositorio que contiene el c칩digo

### Paso 2: Agregar Base de Datos PostgreSQL

1. En tu proyecto de Railway, haz clic en "Add Service"
2. Selecciona "PostgreSQL"
3. Railway aprovisionar치 una base de datos PostgreSQL autom치ticamente

### Paso 3: Configurar Variables de Entorno

En el panel de Railway, ve a **Variables** y establece:

```
# Configuraci칩n de Django
DEBUG=False
SECRET_KEY=generate-a-secure-key-use-django-secret-key-generator
ALLOWED_HOSTS=your-app.railway.app,localhost
ENVIRONMENT=production

# Base de Datos (Railway proporciona esto autom치ticamente)
DATABASE_URL=postgresql://[automatically generated]

# Si usas variables de BD expl칤citas en lugar de DATABASE_URL:
DB_ENGINE=django.db.backends.postgresql
DB_NAME=capacity_planner
DB_USER=postgres
DB_PASSWORD=[auto-generated by Railway]
DB_HOST=[Railway-provided host]
DB_PORT=5432

# Configuraci칩n de CORS (Actualiza con tu URL del frontend)
CORS_ALLOWED_ORIGINS=https://your-frontend.railway.app,https://yourdomain.com

# Configuraci칩n de JWT (opcional, los valores por defecto son adecuados)
JWT_ACCESS_TOKEN_LIFETIME=86400
JWT_REFRESH_TOKEN_LIFETIME=604800
```

### Paso 4: Generar Clave Secreta

Genera una clave secreta segura de Django:

**Opci칩n 1: Usando Python**
```bash
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
```

**Opci칩n 2: Usando OpenSSL**
```bash
openssl rand -base64 32
```

Copia la clave generada y p칠gala en la variable `SECRET_KEY` de Railway.

### Paso 5: Configurar Par치metros de Construcci칩n e Implementaci칩n

1. En Railway, ve a **Settings**
2. Establece estos valores:
   - **Build Command**: Dejar en blanco (usa Dockerfile)
   - **Start Command**: Dejar en blanco (usa Procfile)
   - **Port**: 8000
   - **Python Version**: 3.11

### Paso 6: Desplegar

1. Env칤a tu c칩digo a GitHub:
```bash
git add .
git commit -m "Ready for deployment"
git push origin main
```

2. Railway detectar치 autom치ticamente los cambios y volver치 a desplegar

### Paso 7: Ejecutar Migraciones Iniciales

Despu칠s del primer despliegue:

1. Ve al panel de Railway
2. Abre el servicio web
3. Haz clic en la pesta침a "Logs"
4. Busca los registros de despliegue - las migraciones deber칤an ejecutarse autom치ticamente a trav칠s del Procfile

Si las migraciones no se ejecutaron:
1. Haz clic en "Settings" en el servicio web
2. Busca la secci칩n "Execute Command"
3. Ejecuta: `python manage.py migrate`

### Paso 8: Crear Superusuario

Accede a la terminal de tu aplicaci칩n desplegada:

```bash
# A trav칠s de Railway CLI
railway run python manage.py createsuperuser

# O a trav칠s del panel de Railway:
# 1. Selecciona tu servicio web
# 2. Ve a la pesta침a "Deployment"
# 3. Haz clic en el despliegue en ejecuci칩n
# 4. Abre shell/terminal
# 5. Ejecuta: python manage.py createsuperuser
```

## 游 Lista de Verificaci칩n de Variables de Entorno

- [ ] `DEBUG=False` (nunca True en producci칩n)
- [ ] `SECRET_KEY` establecida en una cadena aleatoria segura
- [ ] `ALLOWED_HOSTS` incluye tu dominio de Railway
- [ ] `DATABASE_URL` configurada para PostgreSQL
- [ ] `CORS_ALLOWED_ORIGINS` incluye tu URL del frontend
- [ ] Todas las variables de base de datos establecidas (si no usas DATABASE_URL)

## 游빍 Prueba del Despliegue

Despu칠s de que se complete el despliegue:

```bash
# Prueba la disponibilidad de la API
curl https://your-app.railway.app/api/

# Prueba el endpoint de autenticaci칩n (reemplaza con tus credenciales)
curl -X POST https://your-app.railway.app/api/token/ \
  -H "Content-Type: application/json" \
  -d '{"username": "TU_USUARIO", "password": "TU_CONTRASE칌A"}'

# Prueba con token
curl -H "Authorization: Bearer <your-token>" \
  https://your-app.railway.app/api/employees/
```

## 游늵 Monitoreo y Registros

### Ver Registros
1. Ve a tu proyecto de Railway
2. Selecciona el servicio web
3. Haz clic en la pesta침a "Logs"
4. Ve los registros de la aplicaci칩n en tiempo real

### Problemas Comunes

#### Error: "relation does not exist"
- Las migraciones no se ejecutaron
- Soluci칩n: Ejecuta manualmente `python manage.py migrate` en el shell de Railway

#### Error: "CORS policy: blocked"
- La URL del frontend no est치 en CORS_ALLOWED_ORIGINS
- Soluci칩n: Actualiza CORS_ALLOWED_ORIGINS en las variables de Railway

#### Error: "SECRET_KEY not set"
- La variable de entorno SECRET_KEY est치 faltando
- Soluci칩n: Agr칠gala a las variables de Railway

#### Error: "could not connect to database"
- Las credenciales de la base de datos son incorrectas o la base de datos no est치 funcionando
- Soluci칩n: Verifica que las variables de BD coincidan con los valores proporcionados por Railway

## 游댃 Despliegue Continuo

Railway vuelve a desplegar autom치ticamente cuando env칤as cambios a tu rama principal:

1. Realiza cambios localmente
2. Confirma y env칤a:
   ```bash
   git add .
   git commit -m "Tu mensaje"
   git push origin main
   ```
3. Railway detecta el env칤o y vuelve a desplegar autom치ticamente
4. Revisa los registros para confirmar el despliegue exitoso

## 游늳 Escalabilidad para 50+ Usuarios

Railway maneja autom치ticamente la escalabilidad. Configuraci칩n:

1. **Memoria**: El valor por defecto de 256MB es suficiente para 50 usuarios
   - Para 100+ usuarios, aumenta a 512MB

2. **CPU**: CPU compartida suficiente para 50 usuarios
   - Para 100+ usuarios, actualiza a dedicada

3. **Base de Datos**: PostgreSQL por defecto es suficiente
   - Para alto volumen, considera actualizar el plan

### Monitorear Rendimiento

1. Ve al panel de Railway
2. Visualiza la pesta침a "Metrics"
3. Monitorea el uso de CPU, memoria y red

## 游댏 Mejores Pr치cticas de Seguridad

- [ ] Usar una SECRET_KEY fuerte (m칤nimo 32 caracteres)
- [ ] Establecer DEBUG=False en producci칩n
- [ ] Usar solo HTTPS (Railway proporciona SSL autom치ticamente)
- [ ] Rotar regularmente secretos y tokens
- [ ] Habilitar las caracter칤sticas de seguridad de Railway
- [ ] Configurar monitoreo y alertas
- [ ] Actualizar regularmente las dependencias

## 游뚿 Copia de Seguridad y Recuperaci칩n

### Copias de Seguridad de la Base de Datos

Railway realiza autom치ticamente copias de seguridad de las bases de datos PostgreSQL.

Para descargar una copia de seguridad:
1. Ve al servicio PostgreSQL en Railway
2. Haz clic en la pesta침a "Data"
3. Descarga el archivo de copia de seguridad

### Copia de Seguridad Manual

```bash
# A trav칠s de Railway CLI
railway run pg_dump $DATABASE_URL > backup.sql
```

## 游꿢 Lista de Verificaci칩n de Producci칩n

Antes de ir en vivo:

- [ ] SECRET_KEY es segura y est치 establecida
- [ ] DEBUG es False
- [ ] ALLOWED_HOSTS incluye tu dominio
- [ ] La base de datos es PostgreSQL
- [ ] CORS_ALLOWED_ORIGINS est치 configurada para el frontend
- [ ] Todas las migraciones aplicadas
- [ ] Superusuario creado
- [ ] Archivos est치ticos configurados
- [ ] Configuraci칩n de correo electr칩nico (si es necesario)
- [ ] Certificado SSL (autom치tico en Railway)
- [ ] Monitoreo habilitado
- [ ] Copias de seguridad configuradas
- [ ] El equipo tiene acceso al panel de Railway

## 游 Soporte y Soluci칩n de Problemas

### Soporte de Railway
- [Documentaci칩n de Railway](https://docs.railway.app)
- [Discord Comunitario de Railway](https://discord.gg/railway)

### Soporte de Django
- [Documentaci칩n de Django](https://docs.djangoproject.com)
- [Django REST Framework](https://www.django-rest-framework.org)

### Comandos Comunes

```bash
# Conectarse a Railway CLI
railway login
railway link  # Vincular proyecto local a proyecto de Railway

# Ejecutar comandos remotamente
railway run python manage.py shell
railway run python manage.py migrate
railway run python manage.py createsuperuser

# Ver registros
railway logs

# Volver a desplegar
railway deploy
```

## 游꿉 Recursos Adicionales

- [Tutorial de Django en Railway](https://docs.railway.app/guides/django)
- [Lista de Verificaci칩n de Despliegue de Django](https://docs.djangoproject.com/en/4.2/howto/deployment/checklist/)
- [Mejores Pr치cticas de PostgreSQL](https://www.postgresql.org/docs/current/sql-syntax.html)

---

**칔ltima Actualizaci칩n**: 6 de enero de 2026
**Versi칩n**: 1.0.0

Para obtener ayuda adicional, consulta API_DOCUMENTATION.md o README.md
